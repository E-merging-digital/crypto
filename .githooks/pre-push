#!/usr/bin/env bash
set -euo pipefail

EXEC=""
if command -v ddev >/dev/null 2>&1; then
  if ddev describe >/dev/null 2>&1; then
    EXEC="ddev exec --"
  fi
fi

echo ">>> [pre-push] GrumPHP testsuite: pre-push (PHPUnit complet)"
$EXEC ./vendor/bin/grumphp run --testsuite pre-push

# Optionnel : Behat local s'il existe (ne casse pas si absent)
if [ -x ./vendor/bin/behat ] && [ -f ./behat.yml ]; then
  echo ">>> [pre-push] Behat (profile: local)"
  $EXEC ./vendor/bin/behat -c behat.yml -p local --colors --strict
fi
