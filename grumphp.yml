grumphp:
  git_hook_variables:
    EXEC_GRUMPHP_COMMAND: 'bash -lc "if command -v ddev >/dev/null 2>&1; then ddev exec -- {cmd}; else {cmd}; fi"'

  hooks_preset: local
  process_timeout: 900
  parallel:
    enabled: true

  tasks:
    phplint:
      triggered_by: [php, module, inc, install, profile, theme, engine]
      exclude:
        - vendor
        - web/core
        - web/modules/contrib
        - web/themes/contrib

    phpcs:
      standard: 'phpcs.xml.dist'
      ignore_patterns:
        - '/vendor/*'
        - '/web/core/*'
        - '/web/modules/contrib/*'
        - '/web/themes/contrib/*'
      triggered_by: [php, module, inc, install, profile, theme, engine]

    phpstan:
      configuration: 'phpstan.neon'
      memory_limit: '-1'

    phpunit:
      config_file: 'phpunit.xml.dist'
      testsuite: 'Unit'
      always_execute: true

    twigcs:
      # Cette version de l’intégration TwigCS n’accepte pas "paths".
      # On scanne depuis la racine et on exclut tout sauf le custom.
      ruleset: 'FriendsOfTwig\Twigcs\Ruleset\Official'
      severity: 'warning'
      display: 'detailed'
      path: '.'
      exclude:
        - 'vendor'
        - 'web/core'
        - 'web/modules/contrib'
        - 'web/themes/contrib'
        - 'node_modules'
        - '.ddev'
        - '.git'

    jsonlint:
      detect_key_conflicts: true
      ignore_patterns:
        - '/vendor/*'

    xmllint:
      ignore_patterns:
        - '/vendor/*'

  testsuites:
    pre-commit:
      tasks:
        - phplint
        - phpcs
        - phpstan
        - phpunit
        - twigcs
        - jsonlint
        - xmllint

    pre-push:
      tasks:
        - phpunit
